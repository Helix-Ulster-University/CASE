<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CASE Audio Samples — Generated & OOD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Multilingual crime-from-speech dataset samples (CASE): audio clips per language, class, and set (Generated/OOD)" />
  <style>
    :root{ --bg:#0f1220; --panel:#161a2f; --panel-2:#1c2140; --text:#e7e9f7; --muted:#aab0d6; --accent:#7aa2ff; --accent-2:#6df0c2; --chip:#252b57; --border:#2b3266; }
    *{box-sizing:border-box}
    body{ margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans"; color:var(--text); background: radial-gradient(1200px 600px at 20% -10%, #1b2146 0, #0f1220 45%) fixed; }
    header{ position:sticky; top:0; z-index:5; backdrop-filter:saturate(120%) blur(8px); background:linear-gradient(180deg, rgba(15,18,32,.85), rgba(15,18,32,.55)); border-bottom:1px solid var(--border); }
    .wrap{max-width:1150px; margin:0 auto; padding:18px}
    .brand{display:flex; gap:12px; align-items:center}
    .brand .dot{width:12px; height:12px; border-radius:50%; background:linear-gradient(45deg, var(--accent), var(--accent-2))}
    h1{font-size:20px; margin:0}
    .controls{ display:grid; grid-template-columns:repeat(4,minmax(0,1fr)) auto; gap:10px; margin-top:14px }
    select, button, input[type="search"]{ background:var(--panel); color:var(--text); border:1px solid var(--border); padding:10px 12px; border-radius:10px; outline:none; }
    button{cursor:pointer}
    main{padding:14px 18px}
    .stats{display:flex; flex-wrap:wrap; gap:10px; margin:8px 0 18px}
    .chip{ background:var(--chip); border:1px solid var(--border); color:var(--muted); padding:8px 10px; border-radius:999px; font-size:13px }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); gap:14px }
    .card{ background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid var(--border); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:10px }
    .badgebar{display:flex; gap:8px; align-items:center; justify-content:space-between}
    .badge{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,.03)}
    .badge.set-Generated{border-color:#2d4fff4d}
    .badge.set-OOD{border-color:#22d3a84d}
    .meta{font-size:12px; color:var(--muted)}
    .sr{position:absolute; left:-9999px}
    .footer{color:#95a0e0; font-size:13px; margin:24px 0 60px}
    .pilltabs{display:flex; gap:8px; flex-wrap:wrap}
    .pilltabs button{border-radius:20px; padding:8px 12px; background:var(--panel); border:1px solid var(--border)}
    .pilltabs button[aria-pressed="true"]{outline:2px solid var(--accent)}
    .empty{opacity:.8; text-align:center; padding:40px 10px; border:1px dashed var(--border); border-radius:12px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <span class="dot" aria-hidden="true"></span>
        <h1>CASE Audio Samples — Multilingual Crime-from-Speech</h1>
      </div>
      <div class="controls" role="region" aria-label="filters">
        <div class="pilltabs" role="tablist" aria-label="Set">
          <button id="tab-generated" role="tab" aria-pressed="true" onclick="setSet('Generated')">Generated</button>
          <button id="tab-ood" role="tab" aria-pressed="false" onclick="setSet('OOD')">OOD</button>
        </div>
        <select id="lang" aria-label="Language" onchange="refresh()">
          <option value="all">All Languages</option>
          <option value="en">English</option>
          <option value="zh">Chinese</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="ja">Japanese</option>
        </select>
        <select id="cls" aria-label="Class" onchange="refresh()">
          <option value="all">All Classes</option>
          <option value="Crime">Crime</option>
          <option value="Non-Crime">Non-Crime</option>
        </select>
        <input type="search" id="q" placeholder="Search title / notes…" oninput="refresh()" />
        <button onclick="downloadManifest()">Download manifest</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section aria-labelledby="stats"><div class="stats" id="stats"></div></section>
    <section aria-labelledby="samples">
      <h2 id="samples" class="sr">Samples</h2>
      <div id="grid" class="grid" role="list"></div>
      <div id="empty" class="empty" hidden>No matches for your filters.</div>
    </section>
    <p class="footer">Built for the paper “CASE: A Multilingual Corpus for Speech-Centered Crime Detection” — demo viewer only.</p>
  </main>

  <!-- Load manifest via script (works with file://) -->
  <script src="audio/manifest.js"></script>

  <script>
    const LANG_NAME = { en:"English", zh:"Chinese", es:"Spanish", fr:"French", ja:"Japanese" };
    let MANIFEST = [];
    let currentSet = "Generated";

    function normalizeManifest(raw){
      return (raw || []).map(it => {
        const category = (it.category || "").trim();
        const isOOD = /ood/i.test(category);
        const isNonCrime = /^non-?crime/i.test(category);
        const set = isOOD ? "OOD" : "Generated";
        const cls = isNonCrime ? "Non-Crime" : "Crime";
        return {
          set,
          cls,
          lang: it.lang,
          url: it.url,
          title: it.title || `${(LANG_NAME[it.lang]||it.lang)} — ${cls}`,
          note: `${set} | ${it.lang} | ${cls} | ${category}`
        };
      });
    }

    function init(){
      if (!Array.isArray(window.MANIFEST_RAW)) {
        const stats = document.getElementById('stats');
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = 'Error: audio/manifest.js missing or invalid (window.MANIFEST_RAW not found).';
        stats.append(chip);
        return;
      }
      MANIFEST = normalizeManifest(window.MANIFEST_RAW);
      refresh();
    }

    function setSet(s){
      currentSet = s;
      document.getElementById('tab-generated').setAttribute('aria-pressed', String(s==="Generated"));
      document.getElementById('tab-ood').setAttribute('aria-pressed', String(s==="OOD"));
      refresh();
    }

    function refresh(){
      const lang = document.getElementById('lang').value;
      const cls  = document.getElementById('cls').value;
      const q    = document.getElementById('q').value.trim().toLowerCase();

      const items = MANIFEST.filter(it =>
        it.set === currentSet &&
        (lang === "all" || it.lang === lang) &&
        (cls === "all" || it.cls === cls) &&
        (!q || (it.title?.toLowerCase().includes(q) || it.note?.toLowerCase().includes(q)))
      );

      renderStats(items);
      renderGrid(items);
    }

    function renderStats(items){
      const byLang = group(items, x=>x.lang);
      const byCls  = group(items, x=>x.cls);

      const el = document.getElementById('stats');
      el.innerHTML = "";
      const chip = t => { const s=document.createElement('div'); s.className='chip'; s.textContent=t; return s; };

      el.append(chip(`Set: ${currentSet}`));
      el.append(chip(`Total clips: ${items.length}`));
      el.append(chip(`Languages: ` + Object.keys(byLang).map(k=>`${LANG_NAME[k]||k} (${byLang[k].length})`).join(' · ')));
      el.append(chip(`Classes: ` + Object.keys(byCls).map(k=>`${k} (${byCls[k].length})`).join(' · ')));
    }

    function renderGrid(items){
      const grid = document.getElementById('grid');
      const empty = document.getElementById('empty');
      grid.innerHTML = "";
      if (!items.length){ empty.hidden = false; return; }
      empty.hidden = true;

      for (const it of items){
        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('role','listitem');

        const bar = document.createElement('div');
        bar.className = 'badgebar';

        const left = document.createElement('div');
        left.style.display="flex"; left.style.gap="6px"; left.style.alignItems="center";
        const bSet = badge(it.set, 'set-'+it.set);
        const bLang= badge(LANG_NAME[it.lang] || it.lang);
        const bCls = badge(it.cls);
        left.append(bSet,bLang,bCls);

        const right = document.createElement('div');
        right.className='meta';
        right.textContent = it.title || '';
        bar.append(left, right);

        const audio = document.createElement('audio');
        audio.controls = true;
        audio.preload = "none";
        audio.src = it.url;

        const meta = document.createElement('div');
        meta.className='meta';
        meta.textContent = it.note || '';

        card.append(bar, audio, meta);
        grid.append(card);
      }
    }

    function badge(text, extraClass=''){
      const s = document.createElement('span');
      s.className = 'badge' + (extraClass ? ' ' + extraClass : '');
      s.textContent = text;
      return s;
    }

    function group(arr, fn){
      return arr.reduce((acc, x)=>{ const k = fn(x); (acc[k] ||= []).push(x); return acc; }, {});
    }

    function downloadManifest(){
      const blob = new Blob([JSON.stringify(MANIFEST, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'manifest.json';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    init();
  </script>
</body>
</html>
